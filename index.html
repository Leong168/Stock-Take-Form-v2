<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <title>SKU Scanner App</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

Â  Â  <script src="https://unpkg.com/html5-qrcode"></script>

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

Â  <style>
Â  Â  #reader {
Â  Â  Â  width: 100%;
Â  Â  Â  max-height: 80vh;
Â  Â  }
Â  Â  .scrollable-table {
Â  Â  Â  max-height: 200px;
Â  Â  Â  overflow-y: auto;
Â  Â  }
Â  </style>
</head>
<body class="bg-light">

Â  <div class="container py-3">

Â  Â  <h3 class="text-center mb-3">ğŸ“¦ SKU Scanner</h3>

Â  Â  Â  Â  <div id="login-page">
Â  Â  Â  <div class="card p-4 shadow-sm">
Â  Â  Â  Â  <h4 class="card-title text-center">Login</h4>
Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  <label for="userName" class="form-label">Name</label>
Â  Â  Â  Â  Â  <input type="text" id="userName" class="form-control" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  <label for="userLocation" class="form-label">Location</label>
Â  Â  Â  Â  Â  <input type="text" id="userLocation" class="form-control" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="btn btn-primary w-100" onclick="login()">Start Scanning</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="main-app" class="d-none">
Â  Â  Â  Â  Â  Â  <div id="reader" class="mb-3"></div>

Â  Â  Â  Â  Â  Â  <div id="form-section" class="d-none">
Â  Â  Â  Â  <div class="card p-3 shadow-sm">
Â  Â  Â  Â  Â  <div class="mb-2">
Â  Â  Â  Â  Â  Â  <label for="skuName" class="form-label">SKU</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="skuName" class="form-control" readonly>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mb-2">
Â  Â  Â  Â  Â  Â  <label for="quantity" class="form-label">Quantity</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="quantity" class="form-control" min="1">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="btn btn-primary w-100" onclick="addEntry()">Add to List æ·»åŠ åˆ°åˆ—è¡¨ </button>
Â  Â  Â  Â  Â  <button class="btn btn-secondary w-100 mt-2" onclick="rescan()">ğŸ” Rescan é‡æ–°æ‰«æ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-4">
Â  Â  Â  Â  <h5>Scanned Entries</h5>
Â  Â  Â  Â  <div class="scrollable-table border rounded bg-white">
Â  Â  Â  Â  Â  <table class="table table-sm table-striped mb-0">
Â  Â  Â  Â  Â  Â  <thead class="table-light">
Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>#</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>SKU</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Quantity</th>
Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody id="entryTable"></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-3">
Â  Â  Â  Â  <button class="btn btn-success w-100" onclick="exportToExcel()">â¬‡ï¸ Export to Excel æ•°æ®å¯¼å‡º</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  let lastScannedSKU = '';
Â  Â  let entries = [];
Â  Â  let userName = '';
Â  Â  let userLocation = '';

Â  Â  const html5QrCode = new Html5Qrcode("reader");
Â  Â  const qrConfig = { fps: 10, qrbox: { width: 250, height: 250 } };

Â  Â  function login() {
Â  Â  Â  userName = document.getElementById('userName').value.trim();
Â  Â  Â  userLocation = document.getElementById('userLocation').value.trim();

Â  Â  Â  if (userName === '' || userLocation === '') {
Â  Â  Â  Â  alert("Please enter your name and location.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  document.getElementById('login-page').classList.add('d-none');
Â  Â  Â  document.getElementById('main-app').classList.remove('d-none');
Â  Â  Â  startScanner();
Â  Â  }

Â  Â  function startScanner() {
Â  Â  Â  Html5Qrcode.getCameras().then(cameras => {
Â  Â  Â  Â  if (!cameras || cameras.length === 0) {
Â  Â  Â  Â  Â  alert("No camera found.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const backCamera = cameras.find(c => c.label.toLowerCase().includes("back")) || cameras[0];
Â  Â  Â  Â  html5QrCode.start(
Â  Â  Â  Â  Â  { facingMode: "environment" },
Â  Â  Â  Â  Â  qrConfig,
Â  Â  Â  Â  Â  qrMessage => {
Â  Â  Â  Â  Â  Â  html5QrCode.pause();
Â  Â  Â  Â  Â  Â  handleScan(qrMessage);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  );
Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  console.error("Camera error:", err);
Â  Â  Â  Â  alert("Could not start scanner.");
Â  Â  Â  });
Â  Â  }

Â  Â  function handleScan(sku) {
Â  Â  Â  lastScannedSKU = sku;
Â  Â  Â  document.getElementById('skuName').value = sku;
Â  Â  Â  document.getElementById('quantity').value = '';
Â  Â  Â  document.getElementById('form-section').classList.remove('d-none');
Â  Â  Â  document.getElementById('quantity').focus();
Â  Â  }

Â  Â  function addEntry() {
Â  Â  Â  const qty = parseInt(document.getElementById('quantity').value);
Â  Â  Â  if (!qty || qty <= 0) {
Â  Â  Â  Â  alert("Enter a valid quantity.");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  const now = new Date();
Â  Â  Â  const dateString = now.toLocaleDateString(); // e.g., "M/D/YYYY"
Â  Â  Â  const timeString = now.toLocaleTimeString(); // e.g., "h:mm:ss AM/PM"
Â  Â  Â  const fullDate = `${dateString} ${timeString}`;
Â  Â  Â  entries.push({
Â  Â  Â  Â  name: userName,
Â  Â  Â  Â  location: userLocation,
Â  Â  Â  Â  sku: lastScannedSKU,
Â  Â  Â  Â  quantity: qty,
Â  Â  Â  Â  date: fullDate
Â  Â  Â  });
Â  Â  Â  updateTable();
Â  Â  Â  document.getElementById('form-section').classList.add('d-none');
Â  Â  Â  html5QrCode.resume();
Â  Â  }

Â  Â  function rescan() {
Â  Â  Â  document.getElementById('form-section').classList.add('d-none');
Â  Â  Â  html5QrCode.resume();
Â  Â  }

Â  Â  function updateTable() {
Â  Â  Â  const tableBody = document.getElementById("entryTable");
Â  Â  Â  tableBody.innerHTML = '';
Â  Â  Â  entries.forEach((item, index) => {
Â  Â  Â  Â  const row = `<tr>
Â  Â  Â  Â  Â  <td>${index + 1}</td>
Â  Â  Â  Â  Â  <td>${item.sku}</td>
Â  Â  Â  Â  Â  <td>${item.quantity}</td>
Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  tableBody.insertAdjacentHTML("beforeend", row);
Â  Â  Â  });
Â  Â  }

Â  Â  function exportToExcel() {
Â  Â  Â  if (entries.length === 0) {
Â  Â  Â  Â  alert("No entries to export.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const worksheet = XLSX.utils.json_to_sheet(entries, {
Â  Â  Â  Â  header: ["name", "location", "sku", "quantity", "date"]
Â  Â  Â  });
Â  Â  Â  // Map headers to A, B, C, D, E
Â  Â  Â  const newHeaders = {
Â  Â  Â  Â  A: 'Name',
Â  Â  Â  Â  B: 'Location',
Â  Â  Â  Â  C: 'SKU',
Â  Â  Â  Â  D: 'Quantity',
Â  Â  Â  Â  E: 'Date'
Â  Â  Â  };
Â  Â  Â  XLSX.utils.sheet_add_aoa(worksheet, [['Name', 'Location', 'SKU', 'Quantity', 'Date']], { origin: 'A1' });


Â  Â  Â  const workbook = XLSX.utils.book_new();
Â  Â  Â  XLSX.utils.book_append_sheet(workbook, worksheet, "Entries");

Â  Â  Â  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
Â  Â  Â  const blob = new Blob([excelBuffer], { type: "application/octet-stream" });

Â  Â  Â  const url = window.URL.createObjectURL(blob);
Â  Â  Â  const anchor = document.createElement("a");
Â  Â  Â  anchor.href = url;
Â  Â  Â  anchor.download = "v2_sku_entries.xlsx";
Â  Â  Â  document.body.appendChild(anchor);
Â  Â  Â  anchor.click();
Â  Â  Â  document.body.removeChild(anchor);
Â  Â  Â  window.URL.revokeObjectURL(url);
Â  Â  }

Â  Â  // Do not start scanner on load. Wait for login.
Â  </script>
</body>
</html>
